<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#D4AF37">
    <meta name="description" content="سیستم مدیریت خیاطی ALFAJR - نسخه حرفه‌ای">
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="assets/icons/icon-192.png">
    <link rel="apple-touch-icon" href="assets/icons/icon-192.png">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <title>ALFAJR خیاطی - سیستم مدیریت</title>
</head>
<body class="dark-mode">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div id="loadingText" class="loading-text">در حال راه‌اندازی سیستم...</div>
    </div>

    <!-- Global Notification -->
    <div id="globalNotification" class="notification-container"></div>

    <!-- Settings Menu -->
    <div class="settings-menu">
        <button class="settings-btn" onclick="App.toggleSettings()">
            <i class="fas fa-cog"></i>
        </button>
        <div class="settings-dropdown" id="settingsDropdown">
            <button onclick="App.saveDataToFile()">
                <i class="fas fa-save"></i>
                ذخیره پشتیبان
            </button>
            <button onclick="App.loadDataFromFile()">
                <i class="fas fa-folder-open"></i>
                بازیابی پشتیبان
            </button>
            <hr style="border: none; border-top: 1px solid #ddd; margin: 5px 0;">
            <button onclick="App.setTheme('dark')">
                <i class="fas fa-moon"></i>
                حالت تاریک
            </button>
            <button onclick="App.setTheme('light')">
                <i class="fas fa-sun"></i>
                حالت روشن
            </button>
            <button onclick="App.setTheme('vivid')">
                <i class="fas fa-palette"></i>
                حالت ویوید
            </button>
            <hr style="border: none; border-top: 1px solid #ddd; margin: 5px 0;">
            <button onclick="App.optimizeDatabase()">
                <i class="fas fa-broom"></i>
                بهینه‌سازی
            </button>
            <button onclick="App.clearAllData()" class="delete-btn">
                <i class="fas fa-trash"></i>
                پاک‌سازی کامل
            </button>
        </div>
    </div>

    <!-- Hidden File Input for Backup -->
    <input type="file" id="fileInput" accept=".json" style="display: none;">

    <div class="container">
        <!-- Home Page -->
        <div id="homePage">
            <!-- Main Header -->
            <div class="main-header">
                <div class="logo">
                    <i class="fas fa-tshirt"></i>
                    <div>
                        <div>ALFAJR خیاطی</div>
                        <div class="tagline">سیستم مدیریت حرفه‌ای مشتریان و سفارشات</div>
                    </div>
                </div>
            </div>

            <!-- Stats Bar -->
            <div class="stats-bar" id="statsBar">
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-users"></i></div>
                    <div class="stat-value" id="totalCustomers">0</div>
                    <div class="stat-label">کل مشتریان</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                    <div class="stat-value" id="paidCustomers">0</div>
                    <div class="stat-label">پرداخت شده</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-clipboard-list"></i></div>
                    <div class="stat-value" id="activeOrders">0</div>
                    <div class="stat-label">سفارشات فعال</div>
                </div>
            </div>

            <!-- Search Section -->
            <div class="search-section">
                <div class="search-header">
                    <i class="fas fa-search"></i>
                    <h3>جستجوی مشتریان</h3>
                </div>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="جستجو بر اساس نام، شماره تماس، کد یا توضیحات...">
                    <div class="search-buttons">
                        <button class="btn-primary" onclick="App.searchCustomers()">
                            <i class="fas fa-search"></i>
                            جستجو
                        </button>
                        <button class="btn-success" onclick="App.addCustomer()">
                            <i class="fas fa-user-plus"></i>
                            مشتری جدید
                        </button>
                    </div>
                </div>
            </div>

            <!-- Customer List -->
            <div class="customer-list-section">
                <div class="section-title">
                    <i class="fas fa-users"></i>
                    <h3>لیست مشتریان</h3>
                </div>
                <div id="customerList">
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3>هنوز مشتری ثبت نشده است</h3>
                        <p>برای شروع، روی دکمه "مشتری جدید" کلیک کنید</p>
                        <button class="btn-primary" onclick="App.addCustomer()" style="margin-top: 20px;">
                            <i class="fas fa-user-plus"></i> افزودن اولین مشتری
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Page -->
        <div id="profilePage" style="display: none;">
            <!-- Back Button -->
            <button class="back-button btn-secondary" onclick="App.backHome()">
                <i class="fas fa-arrow-right"></i>
                بازگشت به لیست
            </button>

            <!-- Profile Header -->
            <div class="profile-header-section">
                <div class="profile-main-info">
                    <div class="profile-name" id="profileName">نام مشتری</div>
                    <div class="profile-phone" id="profilePhone">
                        <i class="fas fa-phone"></i>
                        <span id="profilePhoneText">شماره تماس</span>
                    </div>
                    <div class="profile-id" id="profileId">کد: ----------</div>
                </div>

                <!-- Print Buttons -->
                <div class="print-buttons-container" id="printButtonsContainer">
                    <button class="btn-primary" onclick="App.printMeasurementLabel()">
                        <i class="fas fa-print"></i>
                        چاپ لیبل اندازه
                    </button>
                    <button class="btn-secondary" onclick="App.printInvoice()">
                        <i class="fas fa-file-invoice"></i>
                        چاپ فاکتور
                    </button>
                </div>
            </div>

            <!-- Customer Notes -->
            <div class="profile-section">
                <div class="section-header">
                    <h3><i class="fas fa-sticky-note"></i> توضیحات مشتری</h3>
                </div>
                <textarea id="customerNotes" placeholder="توضیحات و یادداشت‌های مربوط به این مشتری را اینجا وارد کنید..."></textarea>
            </div>

            <!-- Measurements Section -->
            <div class="profile-section" id="measurementsContainer">
                <div class="section-header">
                    <h3><i class="fas fa-ruler-combined"></i> اندازه‌گیری‌ها</h3>
                </div>
                <div class="measurements-grid" id="measurementsGrid">
                    <!-- اندازه‌گیری‌ها اینجا رندر می‌شوند -->
                </div>
            </div>

            <!-- Models Section -->
            <div class="profile-section" id="modelsContainer">
                <div class="section-header">
                    <h3><i class="fas fa-tshirt"></i> مدل‌ها</h3>
                </div>
                <div class="models-grid" id="modelsGrid">
                    <!-- مدل‌ها اینجا رندر می‌شوند -->
                </div>
            </div>

            <!-- Price & Delivery Section -->
            <div class="profile-section" id="priceDeliveryContainer">
                <div class="price-delivery-grid">
                    <div class="price-section">
                        <h4><i class="fas fa-money-bill-wave"></i> قیمت‌گذاری</h4>
                        <div class="price-input">
                            <label>قیمت کل (تومان):</label>
                            <input type="number" id="totalPrice" min="0" step="1000">
                        </div>
                        <div class="price-input">
                            <label>مبلغ پرداخت شده:</label>
                            <input type="number" id="paidAmount" min="0" step="1000">
                        </div>
                    </div>
                    <div class="delivery-section">
                        <h4><i class="fas fa-calendar-alt"></i> تحویل</h4>
                        <div class="delivery-input">
                            <label>تاریخ تحویل:</label>
                            <input type="text" id="deliveryDate" placeholder="مثال: ۱۴۰۲/۱۰/۱۵">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Orders Section -->
            <div class="profile-section" id="ordersContainer">
                <div class="section-header">
                    <h3><i class="fas fa-clipboard-list"></i> سفارشات</h3>
                    <button class="btn-small" onclick="App.addOrder()">
                        <i class="fas fa-plus"></i> افزودن سفارش
                    </button>
                </div>
                <div id="ordersList">
                    <!-- سفارشات اینجا رندر می‌شوند -->
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="profile-action-buttons">
                <button class="btn-primary" onclick="App.saveCurrentCustomer()">
                    <i class="fas fa-save"></i>
                    ذخیره تغییرات
                </button>
                <button class="btn-success" onclick="App.printMeasurementLabel()">
                    <i class="fas fa-print"></i>
                    چاپ لیبل اندازه
                </button>
                <button class="btn-secondary" onclick="App.printInvoice()">
                    <i class="fas fa-file-invoice"></i>
                    چاپ فاکتور
                </button>
                <button class="btn-danger" onclick="App.deleteCurrentCustomer()">
                    <i class="fas fa-trash"></i>
                    حذف مشتری
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript Files - ترتیب مهم است! -->
    <script src="js/utils.js"></script>
    <script src="js/db.js"></script>
    <script src="js/customer.js"></script>
    <script src="js/validator.js"></script>
    <script src="js/print.js"></script>
    <script src="js/app.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .catch(error => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
